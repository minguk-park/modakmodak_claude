---
name: e2e-scenario
description: "Laravel 프로젝트의 E2E 시나리오를 작성한다. 라우트, 컨트롤러, 모델을 분석하여 사용자 관점의 테스트 시나리오 문서를 생성한다. '시나리오', 'E2E 시나리오', '테스트 시나리오', '테스트 케이스' 키워드 시 자동 활성화."
allowed-tools:
  - Read
  - Grep
  - Glob
  - Write
  - Bash
---

# E2E 시나리오 작성 스킬

Laravel 프로젝트를 분석하여 사용자 관점의 E2E 테스트 시나리오를 작성한다.

## 워크플로우

```
Step 1: 프로젝트 분석 (라우트 → 컨트롤러 → 모델 → 미들웨어)
Step 2: 테스트 대상 기능 목록 도출
Step 3: 시나리오 작성 (Given-When-Then)
Step 4: 시나리오 문서 저장
```

## Step 1: 프로젝트 분석

아래 파일들을 순서대로 분석한다:

```bash
# 1. 라우트 파일 확인
routes/web.php
routes/api.php

# 2. 컨트롤러 목록 확인
app/Http/Controllers/

# 3. 모델 및 관계 확인
app/Models/

# 4. 미들웨어 확인
app/Http/Middleware/

# 5. Form Request 확인 (유효성 검증 규칙)
app/Http/Requests/
```

## Step 2: 기능 목록 도출

분석 결과를 바탕으로 테스트 대상 기능을 정리한다:

| 항목 | 내용 |
|-----|------|
| 기능명 | 해당 기능의 이름 |
| HTTP Method | GET, POST, PUT, DELETE |
| 엔드포인트 | 라우트 경로 |
| 컨트롤러 | 담당 컨트롤러@메서드 |
| 인증 필요 | 인증/미들웨어 필요 여부 |
| 주요 검증 | Form Request 유효성 규칙 |

## Step 3: 시나리오 작성

### 시나리오 형식

각 기능별로 아래 형식으로 작성한다:

```markdown
## 시나리오: [기능명]

### 정상 케이스

**Given** (사전 조건)
- [필요한 데이터/상태 설명]

**When** (실행 동작)
- [사용자 동작 설명]
- HTTP: [METHOD] [endpoint]
- Request Body/Params: [요청 데이터]

**Then** (기대 결과)
- Status: [기대 상태 코드]
- Response: [기대 응답 구조]
- DB: [기대 DB 상태 변화]

### 예외 케이스

**Given** (사전 조건)
- [비정상 상태 설명]

**When** (실행 동작)
- [비정상 입력/동작]

**Then** (기대 결과)
- Status: [에러 상태 코드]
- Response: [에러 응답 구조]

### 엣지 케이스
- [경계값, 특수문자, 빈 값 등 테스트]
```

### 시나리오 유형

| 유형 | 설명 | 예시 |
|-----|------|-----|
| 정상 플로우 | 기본 성공 시나리오 | 회원가입 → 로그인 → 기능 사용 |
| 인증 플로우 | 인증/인가 관련 | 미인증 접근, 권한 부족 |
| CRUD 플로우 | 데이터 생성~삭제 | 생성 → 조회 → 수정 → 삭제 |
| 유효성 플로우 | 입력값 검증 | 필수값 누락, 형식 불일치 |
| 엣지 케이스 | 경계값/특수 상황 | 중복 데이터, 동시성, 대량 데이터 |

## Step 4: 문서 저장

시나리오 문서를 프로젝트 루트에 저장한다:

```
tests/
└── scenarios/
    └── e2e-scenarios.md    # 전체 E2E 시나리오 문서
```

`$ARGUMENTS`가 제공되면 해당 기능/모듈에 대해서만 시나리오를 작성한다.

## 출력 예시

```markdown
# E2E 테스트 시나리오

## 개요
- 프로젝트: [프로젝트명]
- 작성일: [날짜]
- 대상: [전체 / 특정 모듈]
- 총 시나리오: [N개]

---

## 1. 인증

### 시나리오 1.1: 회원가입

#### 정상 케이스

**Given**
- 회원가입 페이지에 접근한 상태
- 미가입 이메일 준비

**When**
- POST /api/register
- Body: { "name": "홍길동", "email": "test@test.com", "password": "password123" }

**Then**
- Status: 201
- Response: { "status": "success", "data": { "user": {...}, "token": "..." } }
- DB: users 테이블에 신규 레코드 생성

#### 예외 케이스: 중복 이메일

**Given**
- 이미 가입된 이메일 (test@test.com)

**When**
- POST /api/register (동일 이메일로 재요청)

**Then**
- Status: 422
- Response: { "status": "error", "message": "이메일이 이미 사용 중입니다." }
```

## 주의사항

1. **프로젝트 분석 먼저**: 시나리오 작성 전 반드시 라우트/컨트롤러/모델을 읽는다
2. **실제 코드 기반**: 추측이 아닌 실제 코드에서 추출한 정보로 작성한다
3. **인증 흐름 포함**: 인증이 필요한 API는 인증 시나리오를 포함한다
4. **데이터 의존성 명시**: 시나리오 간 데이터 의존성을 명확히 표기한다
5. **멀티테넌트 고려**: organization_id 스코프가 있으면 테넌트 격리를 시나리오에 반영한다
